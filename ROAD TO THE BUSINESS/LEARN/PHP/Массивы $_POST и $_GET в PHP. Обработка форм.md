#php #code #learn 
[[Что такое формы HTML]]

## Отправка формы

Рассмотрим типичный пример -- форма обратной связи. 
Пример формы HTML:
```html
<form name="feedback" method="POST" action="form.php"> 
	<label>Ваше имя: <input type="text" name="name"></label> 
	<label>Ваш email: <input type="text" name="email"></label> 
	<label>Сообщение: <textarea name="message"></textarea></label> 
	<input type="submit" name="send" value="Отправить"> 
</form>
```

Почти весь код описывает внешний вид и содержание формы, но нужно обратить внимание на два атрибута тега \<form>, которые нужны для указания на способ обработки данных:

*method* -- атрибут для определения HTTP, который будет передан для передачи данных на сервер.

*action* -- содержит адрес PHP-скрипта, который должен обработать эту форму.

После нажатия на кнопку "отправить", браузер выполняет POST запрос со введёнными данными на адрес, указанный в атрибуте action.

## Обработка формы

После отправки формы управление передаётся PHP-скрипту, который должен получить переданные данные, выполнить с ними какие-либо действия и показать результат.

Результат -- какое-нибудь сообщение об успешном завершении операции, например, "ваши данные успешно отправлены".

В PHP это делается легко -- все данные из формы находятся в глобальном ассоциативном массиве $\_POST. Этот массив всегда будет неявно присутствовать в сценарии, если он был загружен по методу POST.

Каждое поле из формы будет находиться в массиве, где ключом будет значение атрибута name, а значением содержимое поля.

Например, чтобы вывести из формы всю информацию на экран, можно написать такой сценарий:
```php
<?php
	if (isset($_POST)) {
		print("Имя: " . $_POST['name']);
		print("<br>Email: " . $_POST['email']);
		print("<br>Message: " . $_POST['message']);
	}
```

Функция isset служит для определения, существует ли переданная ей переменная. Так мы проверяем, что сценарий загружен методом POST, то есть была отправлена форма.

## Отправка файлов

Кроме текстовой информации, существует возможность отправлять на сервер файлы любых типов. Пример:

```html
<form name="file_upload" method="POST" action="form.php" enctype="multipart/form-data">
	<label>Your Avatar: <input type="file" name="avatar"></label>
	<input type="submit" name="send" value="Send file">
</form>
```

Тут есть два важных отличия от первого примера:

- Появился новый атрибут enctype, который всегда должен иметь значение multipart/form-data. Если его не будет, то файл не отправится.
- Сам файл загружается при помощи поля с типом file.

В PHP загруженный файл будет доступен в другом массиве -- $\_FILES.
```php
<?php
	if (isset($_FILES['avatar'])) {
		$file = $_FILES['avatar'];
		print("File download with name" . $file['name'] . " and size " . $file['size'] . " bytes");
	}
```

PHP автоматически сохраняет все загруженные файлы во временную папку на сервере. Но хранить там файлы нельзя, потому что эта директория периодически очищается. Ссылку на такой файл нельзя дать на сайте. Решение одно, переместить загруженный файл в другую папку. 
Перемещение файлы всегда выполняют сразу после загрузки.

Для начала нужно убедиться, что в рабочей директории проекта существует папка для хранения загруженных файлов. Например: *uploads*.

### Перемещение загруженного файла

Для перемещения файла нужно знать, где он находится сейчас, и адрес папки, в которую он будет переноситься.

С текущем адресом всё крайне просто -- он уже находится в массиве $\_FILES. Новый адрес файла, в свою очередь, состоит из пути к папке и имени файла. Так как папка uploads находится там же, где и текущий сценарий, получить путь к ней можно так: dirname(\_\_FILE__).

Код для перемещения файла в новую папку:
```php
<?php
	$current_path = $_FILES['avatar']['tmp_name'];
	$filename = $_FILES['avatar']['name'];
	$new_path = dirname(**__FILE__**) . '/' . $filename;
	move_uploaded_file($current_path, $new_path);
```

Функция *move_uploaded_file()* выполняет два действия:
- Проверяет, что файл действительно загружен через форму.
- Перемещает загруженный файл по новому адресу.
## Валидация формы

Валидация формы -- это проверка содержимого её полей. Задача такой проверки -- убедиться, что необходимые поля заполнены, а значения в них соответствуют ожидаемому формату.

Например, при регистрации пользователя на сайте, он должен заполнить поля с адресом электронной почты и придумать себе пароль. Оба поля обязательны к заполнению, но значение из поля email также должно быть корректным email-адресом.

Помимо текстовых значений формы, можно проверить формат и размер загружаемых файлов.

### Общий подход к валидации

При выполнении валидации любой формы порядок действий будет всегда одним:
- сформировать массив с именами полей, обязательных к заполнению
- сформировать массив с правилами для валидации формата полей
- получить значения всех полей
