#php #code #learn #backend 

[[Модель взаимодействия современного веба]] 

[[Как работает HTTP]]

В PHP есть все возможности для взаимодействия с HTTP:

-- Получение тела запроса
-- Получение заголовков запроса
-- Добавление/изменение заголовков ответа
-- Управление телом ответа

## Получение тела запроса

Тело запроса -- информация, которую передал браузер при запросе страницы. Но тело запроса присутствует только, если браузер запросил страницу методом POST.

В PHP-сценарии все данные отправленной формы будут доступны в специальном массиве $\_POST.

[[Метод POST]]

## Получение заголовков запроса

Заголовки -- метаинформация, отправленная браузером при запросе сценария.

PHP автоматически извлекает такие заголовки и помещает их в массив $\_SERVER. 

В этом массиве, помимо заголовков есть и другая информация. Значения заголовков запроса находятся под ключами, которые начинаются с HTTP\_. Подробно всё содержимое этого массива описано в [официальной документации](https://www.php.net/manual/ru/reserved.variables.server.php)

Пример, как получить предыдущую страницу, с которой перешёл пользователь:
```php
<?php
	print($_SERVER['HTTP_REFERER']);
```

## Добавление/изменение заголовков ответа

В PHP-сценарии можно управлять всеми заголовками ответа.
Вот примеры сценариев, когда пригодится управление заголовками ответа:

- Кэширование
- Переадресация пользователя
- Установка cookies
- Отправка файлов
- Передача дополнительной информации браузеру

Заголовки ответа нужны для выполнения множества важных задач.

В PHP есть функция для отправки или смены заголовков: header().

Она принимает имя и значение заголовка, добавляет его в список из всех заголовков, которые уйдут в браузер пользователя после окончания работы сценария.

Например: перенаправление пользователя на другую страницу:
```php
<?php
	header("Location: /index.php");
```

> Есть одно ограничение. Заголовки нельзя отправлять, если пользователю к этому моменту уже отправили любой контент. То есть, если показать что-то на экране, например, через print(), то после этого заголовки поменять уже не получится.

### Управление телом ответа

Всё, что PHP выводит на экран, является содержимым ответа. Вызовы функций echo, print, или показ текста через шорт-теги являются телом ответа, которое попадает в браузер пользователю.

## Параметры запроса

Мы привыкли, что на нашем сайте каждый PHP-сценарий отвечает за одну страницу.
Посетитель сайта вводит в адресную строку путь, состоящий из имени домена и имени PHP-сценария, например:

`http://weater-diary.ru/day.php`

## [[Как на одной странице браузера показывать разную информацию]]

### [[Из чего состоит URL]]

### Параметры запроса -- как внешние переменные

Теперь в адресе страницы используются параметры запроса.
Если имя страницы вызывает к исполнению соответствующий PHP-сценарий, то параметры запроса превращаются в спец. внешние переменные в этом сценарии. То есть если в адресе присутствуют такие параметры, то их легко получить внутри кода сценария и выполнить с ними какие-нибудь действия. Например: показать погоду за конкретный день в выбранных единицах измерения.

### Получение параметров запроса

Если есть внешние переменные, то как их прочитать?

Все параметры запроса находятся в специальном, ассоциативном массиве $\_GET.
Значит, сценарий, вызванный с таким адресом: *day.php?date=2017-10-15&tscale=celsius* будет иметь в массива два значения с ключами *date* и *scale*

Запрос на получение данных за выбранный день выглядит так:

```php
<?php
	$date = $_GET['date'] ?? date('Y-m-d');
	$sql = sprintf('SELECT * FROM weather WHERE day = "%s"' . mysql_real_escape_string($con, $date));
```

> Никогда не полагайтесь на существование параметра в массиве $\_GET и делайте проверку либо функцией isset(), либо как в этом примере.

## [[Формирование URL с параметрами запроса]]